{"filter":false,"title":"Npo_registerController.php","tooltip":"/cms/app/Http/Controllers/Npo_registerController.php","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":632,"column":0},"end":{"row":632,"column":1},"action":"insert","lines":["d"],"id":20558}],[{"start":{"row":632,"column":1},"end":{"row":632,"column":2},"action":"insert","lines":["d"],"id":20559}],[{"start":{"row":632,"column":2},"end":{"row":632,"column":4},"action":"insert","lines":["()"],"id":20560}],[{"start":{"row":632,"column":3},"end":{"row":632,"column":4},"action":"insert","lines":["$"],"id":20561}],[{"start":{"row":632,"column":4},"end":{"row":632,"column":5},"action":"insert","lines":["n"],"id":20562}],[{"start":{"row":632,"column":5},"end":{"row":632,"column":6},"action":"insert","lines":["p"],"id":20563}],[{"start":{"row":632,"column":6},"end":{"row":632,"column":7},"action":"insert","lines":["o"],"id":20564}],[{"start":{"row":632,"column":3},"end":{"row":632,"column":7},"action":"remove","lines":["$npo"],"id":20565},{"start":{"row":632,"column":3},"end":{"row":632,"column":16},"action":"insert","lines":["$npo_register"]}],[{"start":{"row":632,"column":17},"end":{"row":632,"column":18},"action":"insert","lines":[";"],"id":20566}],[{"start":{"row":632,"column":17},"end":{"row":632,"column":18},"action":"remove","lines":[";"],"id":20567}],[{"start":{"row":632,"column":17},"end":{"row":632,"column":18},"action":"insert","lines":[";"],"id":20568}],[{"start":{"row":633,"column":8},"end":{"row":633,"column":11},"action":"insert","lines":["// "],"id":20569}],[{"start":{"row":632,"column":16},"end":{"row":632,"column":17},"action":"insert","lines":["-"],"id":20571}],[{"start":{"row":632,"column":17},"end":{"row":632,"column":18},"action":"insert","lines":[">"],"id":20572}],[{"start":{"row":632,"column":18},"end":{"row":632,"column":23},"action":"insert","lines":["title"],"id":20573}],[{"start":{"row":632,"column":23},"end":{"row":632,"column":24},"action":"insert","lines":["."],"id":20574}],[{"start":{"row":632,"column":24},"end":{"row":632,"column":44},"action":"insert","lines":["$npo_register->title"],"id":20575}],[{"start":{"row":632,"column":43},"end":{"row":632,"column":44},"action":"remove","lines":["e"],"id":20576}],[{"start":{"row":632,"column":42},"end":{"row":632,"column":43},"action":"remove","lines":["l"],"id":20577}],[{"start":{"row":632,"column":41},"end":{"row":632,"column":42},"action":"remove","lines":["t"],"id":20578}],[{"start":{"row":632,"column":40},"end":{"row":632,"column":41},"action":"remove","lines":["i"],"id":20579}],[{"start":{"row":632,"column":39},"end":{"row":632,"column":40},"action":"remove","lines":["t"],"id":20580}],[{"start":{"row":632,"column":39},"end":{"row":632,"column":47},"action":"insert","lines":["npo_name"],"id":20581}],[{"start":{"row":632,"column":0},"end":{"row":633,"column":0},"action":"remove","lines":["dd($npo_register->title.$npo_register->npo_name);",""],"id":20582}],[{"start":{"row":632,"column":8},"end":{"row":632,"column":11},"action":"remove","lines":["// "],"id":20583}],[{"start":{"row":632,"column":9},"end":{"row":632,"column":10},"action":"insert","lines":["t"],"id":20584}],[{"start":{"row":632,"column":10},"end":{"row":632,"column":11},"action":"insert","lines":["h"],"id":20585}],[{"start":{"row":632,"column":11},"end":{"row":632,"column":12},"action":"insert","lines":["i"],"id":20586}],[{"start":{"row":632,"column":12},"end":{"row":632,"column":13},"action":"insert","lines":["s"],"id":20587}],[{"start":{"row":632,"column":13},"end":{"row":632,"column":14},"action":"insert","lines":["_"],"id":20588}],[{"start":{"row":632,"column":24},"end":{"row":632,"column":43},"action":"remove","lines":["$npo_register->url."],"id":20589},{"start":{"row":632,"column":24},"end":{"row":632,"column":68},"action":"insert","lines":["$npo_register->title.$npo_register->npo_name"]}],[{"start":{"row":635,"column":30},"end":{"row":635,"column":31},"action":"remove","lines":["\""],"id":20590}],[{"start":{"row":635,"column":29},"end":{"row":635,"column":30},"action":"remove","lines":["/"],"id":20591}],[{"start":{"row":635,"column":28},"end":{"row":635,"column":29},"action":"remove","lines":["\""],"id":20592}],[{"start":{"row":635,"column":28},"end":{"row":635,"column":29},"action":"insert","lines":["$"],"id":20593}],[{"start":{"row":635,"column":29},"end":{"row":635,"column":30},"action":"insert","lines":["t"],"id":20594}],[{"start":{"row":635,"column":30},"end":{"row":635,"column":31},"action":"insert","lines":["h"],"id":20595}],[{"start":{"row":635,"column":31},"end":{"row":635,"column":32},"action":"insert","lines":["i"],"id":20596}],[{"start":{"row":635,"column":32},"end":{"row":635,"column":33},"action":"insert","lines":["s"],"id":20597}],[{"start":{"row":635,"column":28},"end":{"row":635,"column":33},"action":"remove","lines":["$this"],"id":20598},{"start":{"row":635,"column":28},"end":{"row":635,"column":37},"action":"insert","lines":["$this_url"]}],[{"start":{"row":632,"column":68},"end":{"row":632,"column":69},"action":"remove","lines":[":"],"id":20599}],[{"start":{"row":632,"column":68},"end":{"row":632,"column":69},"action":"insert","lines":[")"],"id":20600}],[{"start":{"row":632,"column":69},"end":{"row":632,"column":70},"action":"insert","lines":[";"],"id":20601}],[{"start":{"row":632,"column":68},"end":{"row":632,"column":69},"action":"remove","lines":[")"],"id":20602}],[{"start":{"row":632,"column":45},"end":{"row":632,"column":46},"action":"insert","lines":["\""],"id":20603}],[{"start":{"row":632,"column":46},"end":{"row":632,"column":47},"action":"insert","lines":["\""],"id":20604}],[{"start":{"row":632,"column":47},"end":{"row":632,"column":48},"action":"insert","lines":["."],"id":20605}],[{"start":{"row":632,"column":46},"end":{"row":632,"column":47},"action":"insert","lines":["/"],"id":20606}],[{"start":{"row":126,"column":9},"end":{"row":127,"column":0},"action":"insert","lines":["",""],"id":20607},{"start":{"row":127,"column":0},"end":{"row":127,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":127,"column":8},"end":{"row":127,"column":35},"action":"insert","lines":["return view('/errors/503');"],"id":20608}],[{"start":{"row":127,"column":35},"end":{"row":128,"column":0},"action":"insert","lines":["",""],"id":20609},{"start":{"row":128,"column":0},"end":{"row":128,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":128,"column":8},"end":{"row":128,"column":9},"action":"insert","lines":["}"],"id":20610},{"start":{"row":128,"column":0},"end":{"row":128,"column":8},"action":"remove","lines":["        "]},{"start":{"row":128,"column":0},"end":{"row":128,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":128,"column":1},"end":{"row":128,"column":5},"action":"insert","lines":["    "],"id":20611}],[{"start":{"row":127,"column":8},"end":{"row":127,"column":12},"action":"insert","lines":["    "],"id":20612}],[{"start":{"row":126,"column":9},"end":{"row":127,"column":0},"action":"insert","lines":["",""],"id":20613},{"start":{"row":127,"column":0},"end":{"row":127,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":127,"column":8},"end":{"row":128,"column":8},"action":"insert","lines":["if(\"\" == $npo_auth){","        "],"id":20614}],[{"start":{"row":128,"column":8},"end":{"row":129,"column":8},"action":"remove","lines":["","        "],"id":20615}],[{"start":{"row":127,"column":12},"end":{"row":127,"column":13},"action":"insert","lines":["h"],"id":20616}],[{"start":{"row":127,"column":13},"end":{"row":127,"column":14},"action":"insert","lines":["o"],"id":20617}],[{"start":{"row":127,"column":14},"end":{"row":127,"column":15},"action":"insert","lines":["m"],"id":20618}],[{"start":{"row":127,"column":15},"end":{"row":127,"column":16},"action":"insert","lines":["e"],"id":20619}],[{"start":{"row":126,"column":9},"end":{"row":129,"column":6},"action":"remove","lines":["","        if(\"home\" == $npo_auth){","            return view('/errors/503');","\t    }"],"id":20620}],[{"start":{"row":122,"column":48},"end":{"row":123,"column":0},"action":"insert","lines":["",""],"id":20621},{"start":{"row":123,"column":0},"end":{"row":123,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":123,"column":12},"end":{"row":126,"column":6},"action":"insert","lines":["","        if(\"home\" == $npo_auth){","            return view('/errors/503');","\t    }"],"id":20622}],[{"start":{"row":124,"column":0},"end":{"row":124,"column":4},"action":"insert","lines":["    "],"id":20623},{"start":{"row":125,"column":0},"end":{"row":125,"column":4},"action":"insert","lines":["    "]},{"start":{"row":126,"column":0},"end":{"row":126,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":123,"column":12},"end":{"row":124,"column":12},"action":"remove","lines":["","            "],"id":20624}],[{"start":{"row":203,"column":5},"end":{"row":220,"column":6},"action":"insert","lines":["$currentNpoInfo = Npo_register::find($npo_name);","        $npo_manager    = $currentNpoInfo->manager;","        ","        $project        = $currentNpoInfo->subtitle;","        $this_user_auth = \\DB::table('users')->where('name', $npo_manager)->first();","        $org            = $this_user_auth->npo;","        $url            = './'.$org.'/'.$project;","        // dd($org);","\t    if(Auth::user()){","    \t\t$user_auth = Auth::user()->email;","            $auth_name = Auth::user()->name;","\t    }else{","            return redirect($url);","        }","        ","\t    if($auth_name !== $npo_manager || $currentNpoInfo->proval > 0){","            return redirect($url);","\t    }"],"id":20625}],[{"start":{"row":220,"column":6},"end":{"row":222,"column":8},"action":"remove","lines":["","\t\t$user_auth = Auth::user()->email;","        "],"id":20626}],[{"start":{"row":220,"column":6},"end":{"row":221,"column":0},"action":"insert","lines":["",""],"id":20627},{"start":{"row":221,"column":0},"end":{"row":221,"column":5},"action":"insert","lines":["\t    "]}],[{"start":{"row":349,"column":5},"end":{"row":350,"column":20},"action":"remove","lines":["","        // dd($npo);"],"id":20629}],[{"start":{"row":364,"column":8},"end":{"row":370,"column":3},"action":"insert","lines":["// データベースからnpo_nameに該当するユーザーの情報をまとめて抜き出して","    \t$currentNpoInfo     = \\DB::table('npo_registers')->where('npo_name', $npo_name)->first();","    \t$currentPremierData = \\DB::table('premier_data')->where('vision_id', $npo_name)->get();","        $messageData        = \\DB::table('messages')->where('to', $npo_name)->orderBy('id','desc')->get();","        if(!$currentNpoInfo){","\t\t    return view('/errors/503');","\t\t}"],"id":20630}],[{"start":{"row":367,"column":8},"end":{"row":368,"column":8},"action":"remove","lines":["$messageData        = \\DB::table('messages')->where('to', $npo_name)->orderBy('id','desc')->get();","        "],"id":20631}],[{"start":{"row":364,"column":8},"end":{"row":370,"column":8},"action":"remove","lines":["// データベースからnpo_nameに該当するユーザーの情報をまとめて抜き出して","    \t$currentNpoInfo     = \\DB::table('npo_registers')->where('npo_name', $npo_name)->first();","    \t$currentPremierData = \\DB::table('premier_data')->where('vision_id', $npo_name)->get();","        if(!$currentNpoInfo){","\t\t    return view('/errors/503');","\t\t}","        "],"id":20632}],[{"start":{"row":361,"column":8},"end":{"row":362,"column":0},"action":"insert","lines":["",""],"id":20633},{"start":{"row":362,"column":0},"end":{"row":362,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":361,"column":8},"end":{"row":362,"column":8},"action":"insert","lines":["$messageData        = \\DB::table('messages')->where('to', $npo_name)->orderBy('id','desc')->get();","        "],"id":20634}],[{"start":{"row":362,"column":8},"end":{"row":363,"column":8},"action":"remove","lines":["","        "],"id":20635}],[{"start":{"row":364,"column":3},"end":{"row":365,"column":0},"action":"insert","lines":["",""],"id":20637},{"start":{"row":365,"column":0},"end":{"row":365,"column":2},"action":"insert","lines":["\t\t"]}],[{"start":{"row":365,"column":2},"end":{"row":366,"column":0},"action":"insert","lines":["",""],"id":20638},{"start":{"row":366,"column":0},"end":{"row":366,"column":2},"action":"insert","lines":["\t\t"]}],[{"start":{"row":365,"column":2},"end":{"row":393,"column":9},"action":"insert","lines":["","        // messagesテーブルからメッセージを取ってくる（6/3の開発合宿で追加）","        $data['from']    = array(0=>\"from\");","        $data['to']      = array(0=>\"to\");","        $data['message'] = array(0=>\"message\");","        $data['created'] = array(0=>\"created\");","        $data['fromPic'] = array(0=>\"fromPic\");","        $from_pic        = \"\";","        for($message_count=0; $message_count <count($messageData); $message_count++){","            $from_origin    = $messageData[$message_count]->from;","            $to_origin      = $messageData[$message_count]->to;","            $message_origin = $messageData[$message_count]->message;","            $created_origin = $messageData[$message_count]->created_at;","            $from_user_info = \\DB::table('users')->where('name', $from_origin)->first();","            $from_user_pic  = \\DB::table('personal_info')->where('user_id', $from_user_info->email)->first();","            if($from_user_pic){","                $from_pic = $from_user_pic->image_id;","            }else{","                $from_pic = \"placeholder.jpg\";","            }","            // dd($from_user_pic->image_id);","            ","            $data['from']    += array($message_count+1 => $from_origin);","            $data['to']      += array($message_count+1 => $to_origin);","            $data['message'] += array($message_count+1 => $message_origin);","            $data['created'] += array($message_count+1 => $created_origin);","            $data['fromPic'] += array($message_count+1 => $from_pic);","            // dd($data);","        }"],"id":20639}],[{"start":{"row":393,"column":9},"end":{"row":394,"column":2},"action":"remove","lines":["","\t\t"],"id":20640}],[{"start":{"row":365,"column":2},"end":{"row":366,"column":8},"action":"remove","lines":["","        "],"id":20641}],[{"start":{"row":361,"column":8},"end":{"row":362,"column":8},"action":"remove","lines":["$messageData        = \\DB::table('messages')->where('to', $npo_name)->orderBy('id','desc')->get();","        "],"id":20642}],[{"start":{"row":365,"column":8},"end":{"row":366,"column":8},"action":"insert","lines":["$messageData        = \\DB::table('messages')->where('to', $npo_name)->orderBy('id','desc')->get();","        "],"id":20643}],[{"start":{"row":365,"column":24},"end":{"row":365,"column":28},"action":"remove","lines":["    "],"id":20644}],[{"start":{"row":365,"column":24},"end":{"row":365,"column":25},"action":"insert","lines":[" "],"id":20645}],[{"start":{"row":518,"column":5},"end":{"row":559,"column":3},"action":"remove","lines":["// 公開時のバリデーション","    \tif($npo_register->published){","\t\t    $rules = [","                'title'                   => 'required | min:1 | max:55',","                'support_limit'           => 'digits_between:2,9',","                'support_amount'          => 'required | digits_between:4,6', // 個人寄付の金額","                'support_price_gold'      => 'required | digits_between:5,7', // 企業寄付の金額","                'support_amount_gold'     => 'required | digits_between:1,2', // 企業寄付の定員数","                'support_price_pratinum'  => 'required | digits_between:6,8', // 企業（プラチナ）寄付の金額","    \t        'support_amount_pratinum' => 'required | digits_between:1,2', // 企業（プラチナ）寄付の定員数","                //'url'                     => 'url',","                'npo_name'                => 'alpha_dash',","    \t\t];","\t\t}else{","    \t\tif($npo_register->proval < 1){","    \t\t    // 未公開の時","        \t\t$rules = [","                    'title'                   => 'required | min:1 | max:55',","        \t\t    'support_contents_detail' => 'date | after:tomorrow',","                    'support_limit'           => 'digits_between:1,9',","                    'support_amount'          => 'required | digits_between:4,6', // 個人寄付の金額","                    'support_price_gold'      => 'required | digits_between:5,7', // 企業寄付の金額","                    'support_amount_gold'     => 'required | digits_between:1,2', // 企業寄付の定員数","                    'support_price_pratinum'  => 'required | digits_between:6,8', // 企業（プラチナ）寄付の金額","        \t        'support_amount_pratinum' => 'required | digits_between:1,2', // 企業（プラチナ）寄付の定員数","                    //'url'                     => 'url',","                    'npo_name'                => 'unique:npo_registers|alpha_dash',","        \t\t];","    \t\t}else{","    \t\t    $rules = [","                    'title'                   => 'required | min:1 | max:55',","        \t\t    'support_amount'          => 'digits_between:3,6',","                    'support_limit'           => 'digits_between:2,9',","        \t        'support_price_gold'      => 'required | digits_between:5,7', // 企業寄付の金額","                    'support_amount_gold'     => 'required | digits_between:1,2', // 企業寄付の定員数","                    'support_price_pratinum'  => 'required | digits_between:6,8', // 企業（プラチナ）寄付の金額","        \t        'support_amount_pratinum' => 'required | digits_between:1,2', // 企業（プラチナ）寄付の定員数","                    //'url'                     => 'url',","                    'npo_name'                => 'unique:npo_registers|required | alpha_dash',","        \t    ];","        \t}","\t\t}"],"id":20646},{"start":{"row":518,"column":5},"end":{"row":559,"column":3},"action":"insert","lines":["// 公開時のバリデーション","    \tif($npo_register->published){","\t\t    $rules = [","                'title'                   => 'required | min:1 | max:55',","                // 'support_limit'           => 'digits_between:2,9',","                'support_amount'          => 'required | digits_between:1,10', // 個人寄付の金額","                'support_price_gold'      => 'required | digits_between:5,7', // 企業寄付の金額","                'support_amount_gold'     => 'required | digits_between:1,2', // 企業寄付の定員数","                'support_price_pratinum'  => 'required | digits_between:6,8', // 企業（プラチナ）寄付の金額","    \t        'support_amount_pratinum' => 'required | digits_between:1,2', // 企業（プラチナ）寄付の定員数","                //'url'                     => 'url',","                // 'npo_name'                => 'alpha_dash',","    \t\t];","\t\t}else{","    \t\tif($npo_register->proval < 1){","    \t\t    // 未公開の時","        \t\t$rules = [","                    'title'                   => 'required | min:1 | max:55',","        \t\t    'support_contents_detail' => 'date | after:tomorrow',","                    // 'support_limit'           => 'digits_between:1,9',","                    'support_amount'          => 'required | digits_between:1,10', // 個人寄付の金額","                    'support_price_gold'      => 'required | digits_between:5,7', // 企業寄付の金額","                    'support_amount_gold'     => 'required | digits_between:1,2', // 企業寄付の定員数","                    'support_price_pratinum'  => 'required | digits_between:6,8', // 企業（プラチナ）寄付の金額","        \t        'support_amount_pratinum' => 'required | digits_between:1,2', // 企業（プラチナ）寄付の定員数","                    //'url'                     => 'url',","                    // 'npo_name'                => 'unique:npo_registers|alpha_dash',","        \t\t];","    \t\t}else{","    \t\t    $rules = [","                    'title'                   => 'required | min:1 | max:55',","        \t\t    'support_amount'          => 'digits_between:1,10',","                    // 'support_limit'           => 'digits_between:2,9',","        \t        'support_price_gold'      => 'required | digits_between:5,7', // 企業寄付の金額","                    'support_amount_gold'     => 'required | digits_between:1,2', // 企業寄付の定員数","                    'support_price_pratinum'  => 'required | digits_between:6,8', // 企業（プラチナ）寄付の金額","        \t        'support_amount_pratinum' => 'required | digits_between:1,2', // 企業（プラチナ）寄付の定員数","                    //'url'                     => 'url',","                    // 'npo_name'                => 'unique:npo_registers|required | alpha_dash',","        \t    ];","        \t}","\t\t}"]}],[{"start":{"row":523,"column":75},"end":{"row":523,"column":76},"action":"remove","lines":["0"],"id":20647}],[{"start":{"row":523,"column":74},"end":{"row":523,"column":75},"action":"remove","lines":["1"],"id":20648}],[{"start":{"row":523,"column":74},"end":{"row":523,"column":75},"action":"insert","lines":["6"],"id":20649}],[{"start":{"row":538,"column":76},"end":{"row":538,"column":77},"action":"remove","lines":["1"],"id":20650}],[{"start":{"row":538,"column":76},"end":{"row":538,"column":77},"action":"insert","lines":["1"],"id":20651}],[{"start":{"row":538,"column":79},"end":{"row":538,"column":80},"action":"remove","lines":["0"],"id":20652}],[{"start":{"row":538,"column":78},"end":{"row":538,"column":79},"action":"remove","lines":["1"],"id":20653}],[{"start":{"row":538,"column":78},"end":{"row":538,"column":79},"action":"insert","lines":["6"],"id":20654}],[{"start":{"row":522,"column":16},"end":{"row":522,"column":19},"action":"remove","lines":["// "],"id":20655}],[{"start":{"row":522,"column":61},"end":{"row":522,"column":62},"action":"remove","lines":["2"],"id":20656}],[{"start":{"row":522,"column":61},"end":{"row":522,"column":62},"action":"insert","lines":["1"],"id":20657}],[{"start":{"row":537,"column":20},"end":{"row":537,"column":23},"action":"remove","lines":["// "],"id":20658}],[{"start":{"row":550,"column":20},"end":{"row":550,"column":23},"action":"remove","lines":["// "],"id":20659}],[{"start":{"row":550,"column":65},"end":{"row":550,"column":66},"action":"remove","lines":["2"],"id":20660}],[{"start":{"row":550,"column":65},"end":{"row":550,"column":66},"action":"insert","lines":["1"],"id":20661}]]},"ace":{"folds":[],"scrolltop":9871.90625,"scrollleft":0,"selection":{"start":{"row":550,"column":66},"end":{"row":550,"column":66},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":36,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1561388233297,"hash":"1853229b5848725eb0d7aeff6a3117aea7130f87"}